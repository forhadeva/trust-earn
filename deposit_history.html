<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deposit History - Trust Earn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f8fafc; }
        .soft-card { background: rgba(255, 255, 255, 0.9); box-shadow: 0 10px 30px -5px rgba(14, 165, 233, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 20px; }
        .history-card { transition: all 0.3s ease; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #bae6fd; border-radius: 10px; }
    </style>
</head>

<body class="text-gray-700 select-none pb-20 md:pb-10">

    <div class="bg-sky-500 shadow-md sticky top-0 z-50">
        <div class="max-w-md md:max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="profile.html" class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-white hover:bg-white/30 transition">
                    <i class="ph-bold ph-caret-left text-xl"></i>
                </a>
                <h2 class="text-xl font-bold text-white tracking-wide">Deposit History</h2>
            </div>
        </div>
    </div>

    <main class="max-w-md md:max-w-xl mx-auto px-4 mt-6">
        <div class="soft-card overflow-hidden">
            <div class="bg-sky-50/50 px-5 py-4 border-b border-gray-100 flex justify-between items-center">
                <h3 class="font-bold text-gray-700 text-sm">সকল ডিপোজিট</h3>
                <span class="text-[10px] bg-white border border-gray-200 px-2 py-1 rounded-md text-gray-500">সাম্প্রতিক</span>
            </div>

            <div id="history-list" class="max-h-[70vh] overflow-y-auto custom-scrollbar p-2 space-y-2">
                <p class="text-center text-gray-500 text-sm py-10">লোড হচ্ছে...</p>
            </div>
        </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD7naXXNpZLZ4nWWSm1bFUKZQHwu5aLCRQ",
            authDomain: "trustearn-a33fc.firebaseapp.com",
            databaseURL: "https://trustearn-a33fc-default-rtdb.firebaseio.com",
            projectId: "trustearn-a33fc",
            storageBucket: "trustearn-a33fc.firebasestorage.app",
            messagingSenderId: "771810262455",
            appId: "1:771810262455:web:713d706a7c6da52ac77c32"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const userId = localStorage.getItem("earn_session_user");

        if (!userId) {
            window.location.href = "auth.html";
        } else {
            // Fetch deposits from Firebase for this specific user
            database.ref('deposits/').orderByChild('userId').equalTo(userId).on('value', (snapshot) => {
                const listContainer = document.getElementById('history-list');
                listContainer.innerHTML = '';

                if (!snapshot.exists()) {
                    listContainer.innerHTML = '<p class="text-center text-gray-500 text-sm py-10">কোনো ডিপোজিট রেকর্ড নেই</p>';
                    return;
                }

                const deposits = [];
                snapshot.forEach((childSnapshot) => {
                    deposits.push(childSnapshot.val());
                });

                // Sort newest first
                deposits.reverse().forEach(d => {
                    let statusBadge = '';
                    let iconClass = '';
                    let iconColorClass = '';
                    let amountColorClass = '';

                    if (d.status === 'Successful') {
                        statusBadge = '<span class="text-[10px] font-bold text-green-600 bg-green-100 px-2 py-0.5 rounded-full mt-1 inline-block">Successful</span>';
                        iconClass = "ph-check-circle";
                        iconColorClass = "bg-green-50 text-green-500";
                        amountColorClass = "text-green-600";
                    } else if (d.status === 'Rejected') {
                        statusBadge = '<span class="text-[10px] font-bold text-red-600 bg-red-100 px-2 py-0.5 rounded-full mt-1 inline-block">Rejected</span>';
                        iconClass = "ph-x-circle";
                        iconColorClass = "bg-red-50 text-red-500";
                        amountColorClass = "text-gray-400 strike line-through";
                    } else {
                        statusBadge = '<span class="text-[10px] font-bold text-orange-600 bg-orange-100 px-2 py-0.5 rounded-full mt-1 inline-block">Pending</span>';
                        iconClass = "ph-clock";
                        iconColorClass = "bg-orange-50 text-orange-500";
                        amountColorClass = "text-orange-600";
                    }

                    listContainer.innerHTML += `
                    <div class="history-card bg-white p-4 rounded-xl border border-gray-100 flex justify-between items-center">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full ${iconColorClass} flex items-center justify-center shrink-0">
                                <i class="ph-fill ${iconClass} text-2xl"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 text-sm">${d.method}</h4>
                                <p class="text-[10px] text-gray-400 mt-1">TrxID: <span class="font-mono text-gray-600 font-bold uppercase">${d.trxId}</span></p>
                                <p class="text-[10px] text-gray-400 mt-0.5">${d.dateText || "Date not set"}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <h3 class="font-bold ${amountColorClass} text-lg">+ ৳ ${d.amount}</h3>
                            ${statusBadge}
                        </div>
                    </div>
                    `;
                });
            });
        }
    </script>
</body>
</html>
