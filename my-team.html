<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Team - Trust Earn</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f8fafc; }
        .soft-card { background: rgba(255, 255, 255, 0.9); box-shadow: 0 10px 30px -5px rgba(14, 165, 233, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 20px; }
        .stats-gradient { background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color: white; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #bae6fd; border-radius: 10px; }
    </style>
</head>

<body class="text-gray-700 select-none pb-20">

    <div class="bg-sky-500 shadow-md sticky top-0 z-50">
        <div class="max-w-md md:max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="profile.html" class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-white">
                    <i class="ph-bold ph-caret-left text-xl"></i>
                </a>
                <h2 class="text-xl font-bold text-white tracking-wide">My Team</h2>
            </div>
            <div class="bg-white/20 px-3 py-1.5 rounded-full flex items-center gap-1.5 text-white shadow-sm border border-white/10">
                <i class="ph-fill ph-users text-sm"></i>
                <span id="nav-total-count" class="text-sm font-bold">০ জন</span>
            </div>
        </div>
    </div>

    <main class="max-w-md md:max-w-xl mx-auto px-4 mt-6 flex flex-col gap-5">
        <div class="grid grid-cols-2 gap-4">
            <div class="stats-gradient p-4 rounded-2xl relative overflow-hidden">
                <p class="text-[10px] text-sky-100 uppercase font-medium">অ্যাক্টিভ রেফার</p>
                <h3 id="stat-active-count" class="text-2xl font-bold mt-1">০ জন</h3>
                <i class="ph-fill ph-user-check absolute -right-2 -bottom-2 text-5xl text-white/20"></i>
            </div>
            <div class="bg-white soft-card p-4 rounded-2xl border border-sky-100 relative overflow-hidden">
                <p class="text-[10px] text-gray-500 uppercase font-medium">মোট আয় (রেফার)</p>
                <h3 id="stat-total-income" class="text-2xl font-bold mt-1 text-sky-600">৳ ০</h3>
                <i class="ph-fill ph-coins absolute -right-2 -bottom-2 text-5xl text-sky-500/10"></i>
            </div>
        </div>

        <div class="soft-card overflow-hidden">
            <div class="bg-sky-50/50 px-5 py-3 border-b border-gray-100 flex justify-between items-center">
                <h3 class="font-bold text-gray-700 text-sm">রেফারেল লিস্ট</h3>
            </div>
            <div id="team-list" class="max-h-[60vh] overflow-y-auto custom-scrollbar">
                <p class="text-center py-10 text-gray-400 text-sm">মেম্বার লোড হচ্ছে...</p>
            </div>
        </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD7naXXNpZLZ4nWWSm1bFUKZQHwu5aLCRQ",
            authDomain: "trustearn-a33fc.firebaseapp.com",
            databaseURL: "https://trustearn-a33fc-default-rtdb.firebaseio.com",
            projectId: "trustearn-a33fc",
            storageBucket: "trustearn-a33fc.firebasestorage.app",
            messagingSenderId: "771810262455",
            appId: "1:771810262455:web:713d706a7c6da52ac77c32"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const myId = localStorage.getItem("earn_session_user");

        if (myId) {
            database.ref('users').orderByChild('referredBy').equalTo(myId).on('value', (snapshot) => {
                const list = document.getElementById('team-list');
                const navCount = document.getElementById('nav-total-count');
                const activeCountEl = document.getElementById('stat-active-count');
                const incomeEl = document.getElementById('stat-total-income');

                list.innerHTML = '';
                if (!snapshot.exists()) {
                    list.innerHTML = '<p class="text-center py-10 text-gray-400 text-sm">আপনার টিমে কোনো মেম্বার নেই</p>';
                    return;
                }

                let total = 0, active = 0, income = 0;
                snapshot.forEach(child => {
                    const u = child.val();
                    total++;
                    const isActive = u.status === 'Active';
                    if (isActive) { active++; income += 50; }

                    list.innerHTML += `
                    <div class="flex items-center justify-between p-4 border-b border-gray-50 hover:bg-sky-50/50 transition ${!isActive ? 'opacity-70' : ''}">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-sky-100 flex items-center justify-center font-bold text-sky-600 uppercase border border-sky-100">
                                ${u.name.charAt(0)}
                            </div>
                            <div>
                                <h4 class="text-sm font-bold text-gray-800">${u.name}</h4>
                                <p class="text-[10px] text-gray-400 mt-0.5">ID: ${u.id}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-[10px] ${isActive ? 'bg-green-100 text-green-700 border-green-200' : 'bg-gray-100 text-gray-500 border-gray-200'} border px-2 py-0.5 rounded-full font-bold shadow-sm">
                                ${u.status}
                            </span>
                            <p class="text-xs font-bold ${isActive ? 'text-sky-600' : 'text-gray-400'} mt-1.5">+ ৳ ${isActive ? '৫০' : '০'}</p>
                        </div>
                    </div>`;
                });

                navCount.innerText = total + " জন";
                activeCountEl.innerText = active + " জন";
                incomeEl.innerText = "৳ " + income;
            });
        }
    </script>
</body>
</html>
