<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Earning Platform</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
        }

        .soft-card {
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 10px 30px -5px rgba(14, 165, 233, 0.15),
                0 4px 10px -6px rgba(14, 165, 233, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 20px;
        }

        .tab-btn.active {
            background-color: #0ea5e9;
            color: white;
            box-shadow: 0 4px 10px rgba(14, 165, 233, 0.3);
        }

        .tab-btn {
            background-color: transparent;
            color: #64748b;
            transition: all 0.3s;
        }
    </style>
</head>

<body class="text-gray-700 pb-20 md:pb-10">

    <div class="bg-slate-800 shadow-md sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-sky-500 flex items-center justify-center text-white shadow-lg">
                    <i class="ph-bold ph-shield-check text-xl"></i>
                </div>
                <div>
                    <h2 class="text-lg font-bold text-white tracking-wide leading-tight">Admin Panel</h2>
                    <p class="text-[10px] text-sky-400">মাস্টার কন্ট্রোল রুম</p>
                </div>
            </div>
            <button onclick="window.location.href='login.html'"
                class="bg-red-500/20 text-red-400 hover:bg-red-500 hover:text-white px-3 py-1.5 rounded-lg text-sm font-bold transition flex items-center gap-1 border border-red-500/30">
                <i class="ph-bold ph-sign-out"></i> Logout
            </button>
        </div>
    </div>

    <main class="max-w-4xl mx-auto px-4 mt-6">

        <div class="flex bg-white rounded-2xl p-1 mb-6 shadow-sm border border-gray-100 overflow-x-auto hide-scrollbar">
            <button onclick="switchTab('overview')" id="tab-overview"
                class="tab-btn active flex-1 min-w-[100px] py-2.5 text-xs font-bold rounded-xl flex flex-col items-center gap-1">
                <i class="ph-fill ph-squares-four text-lg"></i> Overview
            </button>
            <button onclick="switchTab('deposits')" id="tab-deposits"
                class="tab-btn flex-1 min-w-[100px] py-2.5 text-xs font-bold rounded-xl flex flex-col items-center gap-1 relative">
                <i class="ph-fill ph-download-simple text-lg"></i> Deposits
                <span class="absolute top-1 right-3 w-2.5 h-2.5 bg-red-500 rounded-full animate-pulse"></span>
            </button>
            <button onclick="switchTab('withdraws')" id="tab-withdraws"
                class="tab-btn flex-1 min-w-[100px] py-2.5 text-xs font-bold rounded-xl flex flex-col items-center gap-1 relative">
                <i class="ph-fill ph-upload-simple text-lg"></i> Withdraws
                <span
                    class="absolute top-1 right-3 w-4 h-4 bg-red-500 text-white text-[9px] flex items-center justify-center rounded-full">2</span>
            </button>
        </div>

        <div id="section-overview" class="block space-y-4">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-white soft-card p-4 rounded-2xl border-l-4 border-sky-500">
                    <p class="text-[10px] text-gray-400 font-bold uppercase">মোট ইউজার</p>
                    <h3 id="stat-users" class="text-2xl font-bold text-gray-800 mt-1">০ জন</h3>
                </div>
                <div class="bg-white soft-card p-4 rounded-2xl border-l-4 border-green-500">
                    <p class="text-[10px] text-gray-400 font-bold uppercase">অ্যাক্টিভ ইউজার</p>
                    <h3 id="stat-active" class="text-2xl font-bold text-gray-800 mt-1">০ জন</h3>
                </div>
                <div class="bg-white soft-card p-4 rounded-2xl border-l-4 border-purple-500">
                    <p class="text-[10px] text-gray-400 font-bold uppercase">পেন্ডিং ডিপোজিট</p>
                    <h3 id="stat-dep" class="text-2xl font-bold text-gray-800 mt-1">৳ ০</h3>
                </div>
                <div class="bg-white soft-card p-4 rounded-2xl border-l-4 border-orange-500">
                    <p class="text-[10px] text-gray-400 font-bold uppercase">পেন্ডিং উইথড্র</p>
                    <h3 id="stat-wid" class="text-2xl font-bold text-gray-800 mt-1">৳ ০</h3>
                </div>
            </div>

            <div
                class="bg-gradient-to-r from-slate-800 to-slate-700 p-5 rounded-2xl text-white shadow-lg mt-6 flex justify-between items-center">
                <div>
                    <h3 class="font-bold">ওয়েবসাইট স্ট্যাটাস</h3>
                    <p class="text-xs text-gray-300 mt-0.5">সবকিছু ঠিকঠাক চলছে।</p>
                </div>
                <div
                    class="bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-xs font-bold border border-green-500/50 flex items-center gap-1">
                    <div class="w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"></div> Live
                </div>
            </div>
        </div>

        <div id="section-deposits" class="hidden space-y-4">
            <h3 class="font-bold text-gray-800 mb-2">নতুন অ্যাকাউন্ট অ্যাক্টিভেশন রিকোয়েস্ট</h3>
            <div id="deposit-list" class="space-y-4">
                <!-- Dynamically populated -->
            </div>
        </div>

        <div id="section-withdraws" class="hidden space-y-4">
            <h3 class="font-bold text-gray-800 mb-2">পেন্ডিং উইথড্র রিকোয়েস্ট</h3>
            <div id="withdraw-list" class="space-y-4">
                <!-- Dynamically populated -->
            </div>
        </div>

    </main>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            loadAdminData();
        });

        function loadAdminData() {
            const users = JSON.parse(localStorage.getItem('earn_users_v1') || '[]');
            const deposits = JSON.parse(localStorage.getItem('earn_deposits_v1') || '[]');
            const withdraws = JSON.parse(localStorage.getItem('earn_withdraws_v1') || '[]');

            const pendingDeps = deposits.filter(d => d.status === 'Pending');
            const pendingWids = withdraws.filter(w => w.status === 'Pending');

            // Overview Stats
            document.getElementById('stat-users').innerText = `${users.length} জন`;
            document.getElementById('stat-active').innerText = `${users.filter(u => u.status === 'Active').length} জন`;
            document.getElementById('stat-dep').innerText = `৳ ${pendingDeps.reduce((sum, d) => sum + d.amount, 0)}`;
            document.getElementById('stat-wid').innerText = `৳ ${pendingWids.reduce((sum, w) => sum + w.amount, 0)}`;

            // Deposit List
            const depList = document.getElementById('deposit-list');
            depList.innerHTML = pendingDeps.length === 0 ? '<p class="text-center text-gray-400 text-sm py-4">কোনো রিকোয়েস্ট নেই</p>' : '';
            pendingDeps.forEach(d => {
                const user = users.find(u => u.id === d.userId) || {};
                const initials = (user.name || 'U').substring(0, 2).toUpperCase();
                depList.innerHTML += `
                <div class="soft-card bg-white p-4 flex flex-col gap-3">
                    <div class="flex justify-between items-start border-b border-gray-100 pb-3">
                        <div class="flex gap-3 items-center">
                            <div class="w-10 h-10 bg-sky-100 text-sky-600 rounded-full flex items-center justify-center font-bold">${initials}</div>
                            <div>
                                <h4 class="text-sm font-bold text-gray-800">${user.name || 'Unknown'}</h4>
                                <p class="text-[11px] text-gray-500">Method: <span class="font-bold text-pink-500">${d.method}</span></p>
                            </div>
                        </div>
                        <span class="text-xs font-bold text-sky-600 bg-sky-50 px-2 py-1 rounded border border-sky-100">৳ ${d.amount}</span>
                    </div>
                    <div class="text-xs text-gray-600 bg-gray-50 p-2 rounded">
                        <p><strong>Sender:</strong> ${d.sender}</p>
                        <p class="mt-0.5"><strong>TrxID:</strong> <span class="font-mono text-gray-800 font-bold">${d.trxId}</span></p>
                    </div>
                    <div class="flex gap-2 mt-1">
                        <button onclick="approveDeposit('${d.id}')" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg text-xs font-bold transition flex justify-center items-center gap-1">
                            <i class="ph-bold ph-check"></i> Approve Deposit
                        </button>
                        <button onclick="rejectDeposit('${d.id}')" class="flex-1 bg-red-100 hover:bg-red-200 text-red-600 py-2 rounded-lg text-xs font-bold transition flex justify-center items-center gap-1">
                            <i class="ph-bold ph-x"></i> Reject
                        </button>
                    </div>
                </div>`;
            });

            // Withdraw List
            const widList = document.getElementById('withdraw-list');
            widList.innerHTML = pendingWids.length === 0 ? '<p class="text-center text-gray-400 text-sm py-4">কোনো রিকোয়েস্ট নেই</p>' : '';
            pendingWids.forEach(w => {
                const user = users.find(u => u.id === w.userId) || {};
                const initials = (user.name || 'U').substring(0, 2).toUpperCase();
                widList.innerHTML += `
                <div class="soft-card bg-white p-4 flex flex-col gap-3 border-l-4 border-orange-400">
                    <div class="flex justify-between items-start border-b border-gray-100 pb-3">
                        <div class="flex gap-3 items-center">
                            <div class="w-10 h-10 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center font-bold">${initials}</div>
                            <div>
                                <h4 class="text-sm font-bold text-gray-800">${user.name || 'Unknown'}</h4>
                                <p class="text-[11px] text-gray-500">Balance: ৳ ${user.balance || 0}</p>
                            </div>
                        </div>
                        <span class="text-xs font-bold text-orange-600 bg-orange-50 px-2 py-1 rounded border border-orange-100">৳ ${w.amount}</span>
                    </div>
                    <div class="text-xs text-gray-600 bg-gray-50 p-2 rounded">
                        <p><strong>Method:</strong> <span class="font-bold text-purple-600">${w.method}</span> (${w.type})</p>
                        <p class="mt-0.5"><strong>Receive Number:</strong> <span class="font-mono text-gray-800 font-bold">${w.number}</span></p>
                    </div>
                    <div class="flex gap-2 mt-1">
                        <button onclick="approveWithdraw('${w.id}')" class="flex-1 bg-sky-500 hover:bg-sky-600 text-white py-2 rounded-lg text-xs font-bold transition flex justify-center items-center gap-1">
                            <i class="ph-bold ph-check-circle"></i> Mark as Paid
                        </button>
                        <button onclick="rejectWithdraw('${w.id}')" class="flex-1 bg-red-100 hover:bg-red-200 text-red-600 py-2 rounded-lg text-xs font-bold transition flex justify-center items-center gap-1">
                            <i class="ph-bold ph-x"></i> Reject
                        </button>
                    </div>
                </div>`;
            });
        }

        function approveDeposit(id) {
            if (!confirm("Are you sure to approve this deposit? The amount will be added to the user's balance.")) return;
            const deposits = JSON.parse(localStorage.getItem('earn_deposits_v1') || '[]');
            const users = JSON.parse(localStorage.getItem('earn_users_v1') || '[]');

            const depIndex = deposits.findIndex(d => d.id === id);
            if (depIndex > -1) {
                deposits[depIndex].status = 'Successful';
                const userIndex = users.findIndex(u => u.id === deposits[depIndex].userId);

                if (userIndex > -1) {
                    // Only add deposit amount to the user's balance
                    users[userIndex].balance = (users[userIndex].balance || 0) + Number(deposits[depIndex].amount);
                }

                localStorage.setItem('earn_deposits_v1', JSON.stringify(deposits));
                localStorage.setItem('earn_users_v1', JSON.stringify(users));
                loadAdminData();
            }
        }

        function rejectDeposit(id) {
            if (!confirm("Are you sure to reject this deposit?")) return;
            const deposits = JSON.parse(localStorage.getItem('earn_deposits_v1') || '[]');
            const depIndex = deposits.findIndex(d => d.id === id);
            if (depIndex > -1) {
                deposits[depIndex].status = 'Rejected';
                localStorage.setItem('earn_deposits_v1', JSON.stringify(deposits));
                loadAdminData();
            }
        }

        function approveWithdraw(id) {
            if (!confirm("Are you sure to mark this as paid?")) return;
            const withdraws = JSON.parse(localStorage.getItem('earn_withdraws_v1') || '[]');
            const widIndex = withdraws.findIndex(w => w.id === id);
            if (widIndex > -1) {
                withdraws[widIndex].status = 'Paid';
                localStorage.setItem('earn_withdraws_v1', JSON.stringify(withdraws));
                loadAdminData();
            }
        }

        function rejectWithdraw(id) {
            if (!confirm("Are you sure to reject this withdrawal? The user's balance will be refunded.")) return;
            const withdraws = JSON.parse(localStorage.getItem('earn_withdraws_v1') || '[]');
            const users = JSON.parse(localStorage.getItem('earn_users_v1') || '[]');

            const widIndex = withdraws.findIndex(w => w.id === id);
            if (widIndex > -1) {
                withdraws[widIndex].status = 'Rejected';
                // Refund balance
                const userIndex = users.findIndex(u => u.id === withdraws[widIndex].userId);
                if (userIndex > -1) {
                    users[userIndex].balance += withdraws[widIndex].amount;
                }

                localStorage.setItem('earn_withdraws_v1', JSON.stringify(withdraws));
                localStorage.setItem('earn_users_v1', JSON.stringify(users));
                loadAdminData();
            }
        }

        function switchTab(tabName) {
            // Hide all sections
            document.getElementById('section-overview').classList.add('hidden');
            document.getElementById('section-deposits').classList.add('hidden');
            document.getElementById('section-withdraws').classList.add('hidden');

            // Remove active class from all buttons
            document.getElementById('tab-overview').classList.remove('active');
            document.getElementById('tab-deposits').classList.remove('active');
            document.getElementById('tab-withdraws').classList.remove('active');

            // Show selected section and add active class
            document.getElementById('section-' + tabName).classList.remove('hidden');
            document.getElementById('tab-' + tabName).classList.add('active');
        }
    </script>
</body>

</html>