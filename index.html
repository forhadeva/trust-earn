<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Trust Earn</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-50 text-gray-800 font-sans pb-20 md:pb-0">

    <nav class="bg-sky-500 text-white shadow-md">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="text-xl font-bold tracking-wider">Trust Earn</div>
            <div class="hidden md:flex space-x-8">
                <a href="index.html" class="text-sky-200 font-bold border-b-2 border-sky-200 pb-1">Home</a>
                <a href="task.html" class="hover:text-sky-200 font-medium transition">Task</a>
                <a href="refer.html" class="hover:text-sky-200 font-medium transition">Refer</a>
                <a href="profile.html" class="hover:text-sky-200 font-medium transition">Profile</a>
            </div>
        </div>
    </nav>

    <main class="max-w-md md:max-w-4xl mx-auto px-4 py-8 mt-4">

        <div class="bg-white rounded-2xl shadow-sm p-6 border-t-4 border-sky-500 text-center" id="account-status-card">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">স্বাগতম, <span id="display-name">...</span>!</h1>

            <div id="inactive-content">
                <p class="text-gray-500 mb-6 text-sm md:text-base">আপনার অ্যাকাউন্টটি এখনো অ্যাক্টিভ নয়। কাজ শুরু করতে এবং রেফার করে ইনকাম করতে আজই অ্যাক্টিভ করুন।</p>
                <div class="bg-red-50 rounded-lg p-4 mb-6 inline-block w-full border border-red-100">
                    <p class="text-lg font-semibold text-red-800">Account Status: <span class="text-red-600 font-bold">Inactive</span></p>
                </div><br>
                <button onclick="handleActivation()" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition w-full md:w-auto">
                    ১০০ টাকা দিয়ে অ্যাক্টিভ করুন
                </button>
            </div>

            <div id="active-content" class="hidden">
                <p class="text-gray-500 mb-6 text-sm md:text-base">আপনার অ্যাকাউন্টটি সফলভাবে অ্যাক্টিভ হয়েছে! এখন আপনি টাস্ক সম্পন্ন করে ইনকাম করতে পারবেন।</p>
                <div class="bg-green-50 rounded-lg p-4 mb-6 inline-block w-full border border-green-100">
                    <p class="text-lg font-semibold text-green-800">অ্যাকাউন্ট স্ট্যাটাস: <span class="text-green-600 font-bold">Active</span></p>
                </div><br>
                <button onclick="window.location.href='task.html'" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition w-full md:w-auto">
                    কাজ শুরু করুন
                </button>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mt-6">
            <div class="bg-white p-4 rounded-2xl shadow-sm text-center border border-gray-100">
                <p class="text-gray-500 text-sm mb-1">মূল ব্যালেন্স</p>
                <p class="text-xl font-bold text-sky-600" id="home-balance">৳ ০.০০</p>
            </div>
            <div class="bg-white p-4 rounded-2xl shadow-sm text-center border border-gray-100">
                <p class="text-gray-500 text-sm mb-1">মোট রেফার</p>
                <p class="text-xl font-bold text-sky-600" id="home-refers">০ জন</p>
            </div>
        </div>

    </main>

    <div id="custom-popup" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl w-full max-w-sm p-6 text-center shadow-2xl">
            <h3 id="popup-title" class="text-xl font-bold text-gray-800 mb-2">Notice</h3>
            <p id="popup-message" class="text-gray-500 text-sm mb-6">Message</p>
            <div class="flex gap-3">
                <button onclick="closePopup()" id="btn-popup-cancel" class="flex-1 py-3 bg-gray-100 text-gray-700 font-bold rounded-xl hidden">Cancel</button>
                <button id="btn-popup-confirm" class="flex-1 py-3 bg-sky-500 text-white font-bold rounded-xl">OK</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD7naXXNpZLZ4nWWSm1bFUKZQHwu5aLCRQ",
            authDomain: "trustearn-a33fc.firebaseapp.com",
            databaseURL: "https://trustearn-a33fc-default-rtdb.firebaseio.com",
            projectId: "trustearn-a33fc",
            storageBucket: "trustearn-a33fc.firebasestorage.app",
            messagingSenderId: "771810262455",
            appId: "1:771810262455:web:713d706a7c6da52ac77c32"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let currentUserData = null;
        const userId = localStorage.getItem("earn_session_user");

        if (!userId) {
            window.location.href = "auth.html";
        } else {
            // Real-time listener for user data
            database.ref('users/' + userId).on('value', (snapshot) => {
                const user = snapshot.val();
                if (user) {
                    currentUserData = user;
                    document.getElementById('display-name').innerText = user.name;
                    document.getElementById('home-balance').innerText = "৳ " + (user.balance || 0).toFixed(2);
                    
                    if (user.status === 'Active') {
                        document.getElementById('inactive-content').classList.add('hidden');
                        document.getElementById('active-content').classList.remove('hidden');
                        document.getElementById('account-status-card').classList.replace('border-sky-500', 'border-green-500');
                    }
                } else {
                    window.location.href = "auth.html";
                }
            });
        }

        function handleActivation() {
            if (!currentUserData) return;

            if (currentUserData.balance >= 100) {
                if (confirm("আপনি কি ১০০ টাকা দিয়ে অ্যাকাউন্ট অ্যাক্টিভ করতে চান?")) {
                    const newBalance = currentUserData.balance - 100;
                    database.ref('users/' + userId).update({
                        balance: newBalance,
                        status: 'Active'
                    }).then(() => {
                        alert("সফলভাবে অ্যাক্টিভ হয়েছে! ✅");
                    });
                }
            } else {
                alert("পর্যাপ্ত ব্যালেন্স নেই! দয়া করে ডিপোজিট করুন।");
                window.location.href = "deposit.html";
            }
        }

        function closePopup() { document.getElementById('custom-popup').classList.add('hidden'); }
    </script>
</body>
</html>
